# Auditor's Journal

## Daily Log

- **[Date]**: Initialized journal.
- **[Date]**: Found inconsistency: Mutations returning raw IDs vs Objects. Selected fix: Standardize return types to Objects (Envelope Pattern).
- **[Date]**: Found inconsistency: `deleteWorkspace` in `convex/workspaces.ts` returns `void`. Fix: Updated to return `{ success: true, deleted: true }` and added validators to other void-returning mutations in the same file.
- **[Date]**: Found inconsistency: `deleteComment` in `convex/documents.ts` returned `{ success: true }` and manually set `isDeleted: true`. Fix: Updated to return `{ success: true, deleted: true }` (Envelope Pattern), updated schema to include `deletedAt`/`deletedBy`, and used `softDeleteFields` for consistency. Verified with new test `convex/documentsComments.test.ts`.
- **[2026-02-24]**: Found inconsistency: `convex/customFields.ts` mutations returned `void` instead of objects. Fix: Updated `update`, `remove`, `setValue`, and `removeValue` to return `{ success: true }` or `{ success: true, deleted: true }` (Envelope Pattern), and added explicit `returns` validators.
- **[2026-02-24]**: Found inconsistency: Mutations in `convex/teams.ts`, `convex/projects.ts`, and `convex/issues/mutations.ts` were missing `returns` validators or returning unstructured data. Fix: Enforced Envelope Pattern by adding `returns` validators and ensuring `{ success: true }` (or similar) return objects for consistency.
- **[2026-02-24]**: Found inconsistency: Mutations in `convex/sprints.ts` and `convex/savedFilters.ts` were missing `returns` validators. Fix: Added `returns` validators to enforce the Envelope Pattern (structured object returns).
- **[2026-02-24]**: Found inconsistency: Mutations in `convex/automationRules.ts` and `convex/calendarEvents.ts` were missing `returns` validators or returning unstructured data. Fix: Enforced Envelope Pattern by adding `returns` validators and ensuring `{ success: true }` (or similar) return objects for consistency.
- **[2026-02-24]**: Found inconsistency: Mutations in `convex/userSettings.ts`, `convex/documentTemplates.ts`, and `convex/apiKeys.ts` were implicitly returning `void` or objects without explicit schemas. Fix: Enforced Envelope Pattern by adding `returns` validators and ensuring `{ success: true }` (or `{ success: true, deleted: true }`) return objects for consistency.
- **[2026-02-25]**: Found inconsistency: `convex/issueLinks.ts` used generic function names (`create`, `remove`, `getForIssue`) unlike `createTeam`, `createProject`, etc. Fix: Renamed to `createIssueLink`, `deleteIssueLink`, `getIssueLinks` to strictly follow the `verbEntity` naming convention and distinguish them from generic exports.
- **[2026-02-25]**: Found inconsistency: `convex/notificationPreferences.ts` `update` mutation returned raw ID instead of object. Fix: Updated to return `{ success: true, preferenceId }` (Envelope Pattern). Also updated `convex/organizations.ts` `deleteOrganization` to return `{ success: true, deleted: true }` for consistency. Verified with existing and new tests.
